name: Juju Deployment

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Juju
        run: |
          sudo snap install juju --classic
          # sudo snap install juju-wait --classic

      - name: Bootstrap Juju
        run: |
          juju bootstrap

      - name: Deploy PostgreSQL
        run: |
          juju deploy postgresql

      - name: Deploy Nextcloud
        run: |
          juju deploy nextcloud --channel edge --series jammy

      - name: Relate Nextcloud and PostgreSQL
        run: |
          juju relate nextcloud:database postgresql
